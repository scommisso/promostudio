@using PromoStudio.Web
@{
    string copyrightDate = DateTime.Today.Year.ToString();
    if (DateTime.Today.Year > 2013) {
        copyrightDate = "2013-" + copyrightDate;
    }
    bool isHomeController = string.Compare((string)ViewContext.RouteData.Values["controller"], "Home", StringComparison.OrdinalIgnoreCase) == 0;
    bool isVideosController = string.Compare((string)ViewContext.RouteData.Values["controller"], "Videos", StringComparison.OrdinalIgnoreCase) == 0;
    bool isResourcesController = string.Compare((string)ViewContext.RouteData.Values["controller"], "Resources", StringComparison.OrdinalIgnoreCase) == 0;
    bool isBuildController = string.Compare((string)ViewContext.RouteData.Values["controller"], "Build", StringComparison.OrdinalIgnoreCase) == 0;
}
<!DOCTYPE html>
<html>
<head>
    <title>PromoStudio - @ViewBag.Title</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow">
    <link href="~/Content/css/bootstrap.css" rel="stylesheet" />
    <link href="~/Content/css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="~/Content/css/site.css" rel="stylesheet" />
    <script src="@Url.Content("~/Scripts/lib/modernizr.js")"></script>
</head>
<body>
    <div class="color-band"></div>
    <div class="navbar" @Html.Raw(Context.User.Identity.IsAuthenticated ? "" : "style='display:none'")>
        <div class="navbar-inner">
        <div class="container">
            <ul class="nav">
                @* Add detection to _NavChangeScript *@
                <li id="navHome" @Html.Raw(isHomeController ? "class=\"active\"" : "")><a data-pjax href="@Url.Action("Index", "Home")">Home</a></li>
                <li id="navVideos" @Html.Raw(isVideosController ? "class=\"active\"" : "")><a data-pjax href="@Url.Action("Index", "Videos")">My Videos</a></li>
                <li id="navResources" @Html.Raw(isResourcesController ? "class=\"active\"" : "")><a data-pjax href="@Url.Action("Index", "Resources")">My Resources</a></li>
                <li id="navBuild" @Html.Raw(isBuildController ? "class=\"active\"" : "")><a data-pjax href="@Url.Action("Index", "Build")">Build</a></li>
            </ul>
        </div>
        </div>
    </div>
    <div class="container header-container clearfix">
        <div class="logo">
            <a data-pjax href="@Url.Action("Index", "Home")"><img src="@Url.Content("~/Content/img/ps_logo.png")" alt="PromoStudio" /></a>
        </div>
        <div class="header-nav">
            @RenderSection("headerNav", false)
        </div>
    </div>
    <div class="container main-container">
        <div class="main-data-container">
            @RenderBody()
        </div>
        <hr />
        <div class="footer">
            <p>&copy; PromoStudio @copyrightDate</p>
        </div>
    </div>
    <script src="~/Scripts/require.min.js"></script>
    <script src="~/Scripts/requireConfig.js"></script>
    <script type="text/javascript">
        require(["jquery", "pjax"],
            function ($) {
                var
                    qualifyUrl = function (url) {
                        var a = document.createElement('a');
                        a.href = url; // set string url
                        url = a.href; // get qualified url
                        return url;
                    },
                    determineActiveNav = function () {
                        var root = qualifyUrl("@Html.Raw(Url.Content("~/"))"),
                            loc = document.location.href.substring(root.length).toLowerCase();
                        if (loc.indexOf("videos") === 0) { return "#navVideos"; }
                        if (loc.indexOf("resources") === 0) { return "#navResources"; }
                        if (loc.indexOf("build") === 0) { return "#navBuild"; }
                        return "#navHome";
                    },
                    main = function () {
                        var s = determineActiveNav();
                        $("ul.nav li").removeClass("active");
                        if (s !== null) {
                            $(s).addClass("active");
                        }
                    };
                $(document).pjax('ul.nav a[data-pjax], div.logo a[data-pjax]', 'div.main-data-container');
                $("div.main-data-container").bind("pjax:end", main);
                $(function () {
                    main();
                });
            });
    </script>
    @RenderSection("scripts", required: false)
</body>
</html>
