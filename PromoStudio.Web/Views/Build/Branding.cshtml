@using Newtonsoft.Json
@using PromoStudio.Resources
@model PromoStudio.Web.ViewModels.BrandingViewModel
@{
    Layout = "~/Views/Build/_BuildLayout.cshtml";
}
@section scripts {
    <script>
        require(["viewModels/brandingViewModel", "jquery", "bootstrap"], function (branding, $) {
            $(function () {
                var vm = new branding(@Html.Raw(JsonConvert.SerializeObject(Model)));
                vm.Bind(".brandingWizard", ".build-steps");
            });
        });
    </script>
}

<div class="brandingWizard accordion">
    <div class="panel-group" id="brandingWizard">
        <div id="photoCollapse" class="panel panel-default" style="display: none" data-bind="visible: PhotoSection().IsVisible">
            <div class="panel-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#brandingWizard" href="#photoPanel">
                    <h4 class="panel-title">
                        <div class="step-title" data-bind="text: PhotoSection().TitleText, css: { 'opened': PhotoSection().StartOpen }"></div>
                        <div class="step-subtitle" data-bind="css: { 'opened': PhotoSection().StartOpen }">@Strings.BuildStep__Your_potential_clients_want_to_see_you</div>
                        <div class="step-completed">
                            <span class="step-done glyphicons circle_ok" style="display: none" data-bind="visible: PhotoSection().IsCompleted, css: { 'opened': PhotoSection().StartOpen }"></span>
                        </div>
                    </h4>
                </a>
            </div>
            <div id="photoPanel" class="panel-collapse collapse" data-bind="css: { 'in': PhotoSection().StartOpen }">
                <div class="panel-body">
                    <div class="thumbcontainer clearfix" data-bind="foreach: PhotoSection().PhotoSlots">
                        <a style="display: none" href="#" class="photo-thumbnail"
                            data-bind="visible: true, css: { selected: $root.PhotoSection().IsSelected($data) }, click: function () { $root.PhotoSection().SelectSlot($data); }">
                            <div class="photo-preview" data-bind="css: { completed: $data.IsCompleted }, style: { backgroundImage: $data.PhotoBackground }">
                                <div class="photo-upload" data-bind="css: { hidden: $data.IsCompleted }">
                                    <span class="glyphicons plus"></span>
                                    <span class="photo-upload-label">@Strings.BuildStep__Upload_photo</span>
                                </div>
                                <span class="photo-title" data-bind="text: $data.Title"></span>
                            </div>
                        </a>
                    </div>
                    <div class="photo-selected" style="display: none">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section modals {
    <div class="modal fade" id="photoUploadModal" tabindex="-1" role="dialog" data-show="false">
        <div class="modal-dialog" data-bind="template: { name: 'photo-upload-template' }">
        </div>
    </div>
    
    @* This is in a template to prevent issues with multiple bindings when re-opening the modal *@
    <script type="text/html" id="photo-upload-template">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-bind="click: Cancel">&times;</button>
                <h4 class="modal-title">@Strings.Modals__Choose_a_Photo</h4>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs">
                    <li><a href="#orgPhotos" data-toggle="tab">Company Photos</a></li>
                    <li><a href="#custPhotos" data-toggle="tab">My Photos</a></li>
                </ul>
                <div class="tab-content">
                    <div id="orgPhotos" class="tab-pane fade active in">
                        <div class="thumbcontainer clearfix" data-bind="foreach: OrganizationPhotos">
                            @*                        <a style="display: none" href="#" class="photo-thumbnail"
                                data-bind="visible: true, css: { selected: $root.PhotoSection().IsSelected($data) }, click: function () { $root.PhotoSection().SelectSlot($data); }">
                                <div class="photo-preview" data-bind="style: { backgroundImage: $data.PhotoBackground }">
                                    <span class="photo-title" data-bind="text: $data.Title"></span>
                                </div>
                            </a>*@
                            <a style="display: none" href="#" class="photo-thumbnail"
                               data-bind="visible: true">
                                <div class="photo-preview no-upload" data-bind="style: { backgroundImage: 'url(' + $data.LinkUrl() + ')' }">
                                    <span class="photo-title" data-bind="text: $data.LinkFileName"></span>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div id="custPhotos" class="tab-pane fade">
                        <div class="thumbcontainer clearfix" data-bind="foreach: CustomerPhotos">
                            @*                        <a style="display: none" href="#" class="photo-thumbnail"
                                data-bind="visible: true, css: { selected: $root.PhotoSection().IsSelected($data) }, click: function () { $root.PhotoSection().SelectSlot($data); }">
                                <div class="photo-preview" data-bind="style: { backgroundImage: $data.PhotoBackground }">
                                    <span class="photo-title" data-bind="text: $data.Title"></span>
                                </div>
                            </a>*@
                            <a style="display: none" href="#" class="photo-thumbnail"
                               data-bind="visible: true">
                                <div class="photo-preview no-upload" data-bind="style: { backgroundImage: 'url(' + $data.LinkUrl() + ')' }">
                                    <span class="photo-title" data-bind="text: $data.LinkFileName"></span>
                                </div>
                            </a>
                        </div>
                        <div>
                            Upload a new photo
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-bind="click: Cancel">@Strings.Cancel</button>
                <button type="button" class="btn btn-primary" data-bind="click: Save">@Strings.OK</button>
            </div>
        </div>
    </script>
}
